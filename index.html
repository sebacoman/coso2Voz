<script>
  // ... (todo el código anterior se mantiene igual hasta reconocimiento.onerror)

  reconocimiento.onresult = function(event) {
    const texto = event.results[0][0].transcript.toLowerCase();
    estado.textContent = "🎙️ Esperando que hables...";
    agregarAlChat("🧍", texto);
    responder(texto);
    reconocimiento.stop();  // ← Corregido: Detiene el micrófono
  };

  reconocimiento.onerror = function(event) {
    estado.textContent = `❌ Error: ${event.error}`;
    reconocimiento.stop();  // ← Corregido: Detiene el micrófono en errores
  };

  reconocimiento.onsoundend = function() {
    reconocimiento.stop();  // ← Nuevo: Maneja el final del audio
  };

  function iniciarReconocimiento() {
    reconocimiento.abort();  // ← Nuevo: Evita múltiples activaciones
    estado.textContent = "🎧 Escuchando...";
    reconocimiento.start();
  }

  // ... (el resto del código se mantiene igual)
</script>


