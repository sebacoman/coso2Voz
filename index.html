<script>
  // ... (todo el cÃ³digo anterior se mantiene igual hasta reconocimiento.onerror)

  reconocimiento.onresult = function(event) {
    const texto = event.results[0][0].transcript.toLowerCase();
    estado.textContent = "ğŸ™ï¸ Esperando que hables...";
    agregarAlChat("ğŸ§", texto);
    responder(texto);
    reconocimiento.stop();  // â† Corregido: Detiene el micrÃ³fono
  };

  reconocimiento.onerror = function(event) {
    estado.textContent = `âŒ Error: ${event.error}`;
    reconocimiento.stop();  // â† Corregido: Detiene el micrÃ³fono en errores
  };

  reconocimiento.onsoundend = function() {
    reconocimiento.stop();  // â† Nuevo: Maneja el final del audio
  };

  function iniciarReconocimiento() {
    reconocimiento.abort();  // â† Nuevo: Evita mÃºltiples activaciones
    estado.textContent = "ğŸ§ Escuchando...";
    reconocimiento.start();
  }

  // ... (el resto del cÃ³digo se mantiene igual)
</script>


